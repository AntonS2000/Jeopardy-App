# Исправление проблемы с подключением нескольких игроков в "Инкогнито" вкладках

## Проблема
При подключении игроков с разных вкладок "Инкогнито" на одном устройстве происходило перезаписывание данных одного игрока другим, хотя они должны были находиться в изолированных слотах. Особенно это проявлялось при обновлении вкладок (F5), когда сессия терялась, но игроки могли снова подключаться к тем же слотам.

## Причина
Проблема заключалась в том, что:
1. При обновлении вкладки "Инкогнито" сессия терялась, но игроки могли снова пройти через login с тем же паролем
2. При подключении через WebSocket не учитывался уникальный токен, и при подключении разных вкладок к одному слоту не проверялось, что это один и тот же игрок
3. При дисконнекте одной вкладки состояние игрока могло некорректно обновляться, если другие вкладки все еще были активны

## Решение
1. В функцию `handle_join_player` добавлена проверка токена при подключении игрока к слоту
2. В функцию `login` добавлена проверка токена при входе игрока в систему, с учетом ситуаций, когда сессия пуста
3. В функцию `player` добавлена проверка наличия токена в сессии перед рендерингом шаблона
4. Улучшена логика обработки дисконнекта и логаута, чтобы избежать конфликтов при работе с несколькими вкладками одного игрока
5. Добавлена проверка, что обновления состояния применяются только к соответствующему соединению
6. Добавлена проверка наличия других соединений при дисконнекте, чтобы не ложно отключать игрока при обновлении одной из вкладок

## Основные изменения
- В `handle_join_player`: проверка токена и имени при подключении к занятому слоту
- В `login`: проверка токена при входе игрока, с учетом пустой сессии
- В `player`: проверка наличия токена в сессии перед рендерингом
- В `on_disconnect`: проверка наличия других соединений для того же слота
- В `logout_player`: проверка токена и имени при выходе

Теперь каждый слот изолирован, и данные игроков не перезаписываются при использовании нескольких вкладок "Инкогнито". Игроки могут обновлять свои вкладки без потери данных других игроков.